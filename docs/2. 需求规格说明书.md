# 需求规格说明书

## 1. 文档概述

### 1.1 文档目的
本文档详细描述 Mysysenv 系统的功能需求、非功能需求、接口需求等，为系统设计、开发、测试和验收提供依据。

### 1.2 文档范围
本文档涵盖 Mysysenv v0.1.0 版本的所有需求，包括 GUI 和 CLI 两种交互方式。

### 1.3 参考文档
- 更新需求分析文档.md
- 代码实现（src/ 目录）

## 2. 总体描述

### 2.1 产品功能概述
Mysysenv 是一个 Windows 平台下的多工具环境变量和版本管理工具，主要功能包括：
- 工具配置管理（添加、删除、编辑）
- 版本管理（扫描、下载、安装、卸载、切换）
- 环境变量自动配置
- 下载管理（多镜像、重试、缓存）
- GUI 和 CLI 双界面支持

### 2.2 用户特征
- 技术背景：具有一定计算机使用经验的开发者
- 操作习惯：熟悉命令行或图形界面操作
- 使用频率：日常开发中频繁使用

### 2.3 约束
- 仅支持 Windows 操作系统
- 需要管理员权限修改系统环境变量
- 配置目录位于项目所在目录（或打包后 EXE 所在目录）下的 `config` 文件夹

## 3. 功能需求

### 3.1 工具管理模块

#### FR-001 添加工具配置
| 项目 | 内容 |
|------|------|
| 编号 | FR-001 |
| 名称 | 添加工具配置 |
| 描述 | 用户可以添加新的工具配置 |
| 前置条件 | 应用已启动，用户具有管理员权限 |
| 输入 | 工具名称、可选的预定义配置 |
| 处理流程 | <br>1. 验证工具名称合法性<br>2. 检查工具是否已存在<br>3. 如果有预定义配置则自动填充<br>4. 否则创建空白配置<br>5. 保存到配置文件 |
| 输出 | 操作成功/失败提示 |
| 后置条件 | 工具配置已保存到配置文件 |

#### FR-002 删除工具配置
| 项目 | 内容 |
|------|------|
| 编号 | FR-002 |
| 名称 | 删除工具配置 |
| 描述 | 用户可以删除已有的工具配置 |
| 前置条件 | 工具配置存在 |
| 输入 | 工具名称 |
| 处理流程 | <br>1. 显示确认对话框<br>2. 用户确认后删除配置<br>3. 保存配置文件 |
| 输出 | 操作成功/失败提示 |
| 后置条件 | 工具配置已从配置文件删除 |

#### FR-003 编辑工具配置
| 项目 | 内容 |
|------|------|
| 编号 | FR-003 |
| 名称 | 编辑工具配置 |
| 描述 | 用户可以编辑工具的配置信息 |
| 前置条件 | 工具配置存在 |
| 输入 | 工具根目录、镜像列表、版本命令、环境变量规则、版本获取配置 |
| 处理流程 | <br>1. 验证输入合法性<br>2. 更新配置<br>3. 保存配置文件 |
| 输出 | 操作成功/失败提示 |
| 后置条件 | 工具配置已更新 |

### 3.2 版本管理模块

#### FR-004 扫描本地版本
| 项目 | 内容 |
|------|------|
| 编号 | FR-004 |
| 名称 | 扫描本地版本 |
| 描述 | 扫描工具根目录下的已安装版本 |
| 前置条件 | 工具根目录已配置 |
| 输入 | 工具名称 |
| 处理流程 | <br>1. 遍历工具根目录<br>2. 识别版本目录<br>3. 获取版本信息 |
| 输出 | 已安装版本列表 |
| 后置条件 | 无 |

#### FR-005 获取远程版本
| 项目 | 内容 |
|------|------|
| 编号 | FR-005 |
| 名称 | 获取远程版本 |
| 描述 | 从镜像源获取可用版本列表 |
| 前置条件 | 网络连接正常，镜像源配置正确 |
| 输入 | 工具名称 |
| 处理流程 | <br>1. 检查缓存是否有效<br>2. 如果缓存有效，使用缓存<br>3. 否则从镜像源获取<br>4. 使用正则表达式解析版本<br>5. 保存到缓存 |
| 输出 | 远程可用版本列表 |
| 后置条件 | 缓存已更新（如需） |

#### FR-006 下载安装版本
| 项目 | 内容 |
|------|------|
| 编号 | FR-006 |
| 名称 | 下载安装版本 |
| 描述 | 下载指定版本并安装到工具根目录 |
| 前置条件 | 工具根目录已配置，网络连接正常 |
| 输入 | 工具名称、版本号 |
| 处理流程 | <br>1. 构建下载 URL<br>2. 下载文件（支持重试、限速）<br>3. 显示下载进度<br>4. 解压到工具根目录<br>5. 更新配置 |
| 输出 | 下载进度、操作成功/失败提示 |
| 后置条件 | 版本已安装，配置已更新 |

#### FR-007 卸载版本
| 项目 | 内容 |
|------|------|
| 编号 | FR-007 |
| 名称 | 卸载版本 |
| 描述 | 卸载指定版本 |
| 前置条件 | 版本已安装，且不是当前使用版本 |
| 输入 | 工具名称、版本号 |
| 处理流程 | <br>1. 显示确认对话框<br>2. 删除版本目录<br>3. 更新配置 |
| 输出 | 操作成功/失败提示 |
| 后置条件 | 版本已卸载，配置已更新 |

#### FR-008 切换版本
| 项目 | 内容 |
|------|------|
| 编号 | FR-008 |
| 名称 | 切换版本 |
| 描述 | 切换到指定版本，自动更新环境变量 |
| 前置条件 | 版本已安装 |
| 输入 | 工具名称、版本号 |
| 处理流程 | <br>1. 更新当前版本配置<br>2. 设置 HOME 环境变量<br>3. 更新 PATH 环境变量<br>4. 广播环境变量变更 |
| 输出 | 操作成功/失败提示 |
| 后置条件 | 环境变量已更新，配置已保存 |

### 3.3 配置管理模块

#### FR-009 加载配置
| 项目 | 内容 |
|------|------|
| 编号 | FR-009 |
| 名称 | 加载配置 |
| 描述 | 从配置文件加载配置 |
| 前置条件 | 无 |
| 输入 | 无 |
| 处理流程 | <br>1. 检查配置文件是否存在<br>2. 不存在则创建默认配置<br>3. 加载配置文件<br>4. 验证配置合法性<br>5. 处理向后兼容 |
| 输出 | 配置对象 |
| 后置条件 | 配置已加载 |

#### FR-010 保存配置
| 项目 | 内容 |
|------|------|
| 编号 | FR-010 |
| 名称 | 保存配置 |
| 描述 | 将配置保存到文件 |
| 前置条件 | 配置已加载 |
| 输入 | 配置对象 |
| 处理流程 | <br>1. 验证配置合法性<br>2. 原子方式写入文件（防止损坏） |
| 输出 | 无 |
| 后置条件 | 配置已保存 |

#### FR-011 重置配置
| 项目 | 内容 |
|------|------|
| 编号 | FR-011 |
| 名称 | 重置配置 |
| 描述 | 将配置重置为默认值 |
| 前置条件 | 无 |
| 输入 | 无 |
| 处理流程 | <br>1. 显示确认对话框<br>2. 加载默认配置<br>3. 保存配置 |
| 输出 | 操作成功/失败提示 |
| 后置条件 | 配置已重置为默认 |

### 3.4 环境变量管理模块

#### FR-012 设置环境变量
| 项目 | 内容 |
|------|------|
| 编号 | FR-012 |
| 名称 | 设置环境变量 |
| 描述 | 设置系统环境变量 |
| 前置条件 | 具有管理员权限 |
| 输入 | 变量名、变量值 |
| 处理流程 | <br>1. 打开注册表<br>2. 设置环境变量值<br>3. 广播变更消息 |
| 输出 | 成功/失败 |
| 后置条件 | 环境变量已设置 |

#### FR-013 删除环境变量
| 项目 | 内容 |
|------|------|
| 编号 | FR-013 |
| 名称 | 删除环境变量 |
| 描述 | 删除系统环境变量 |
| 前置条件 | 具有管理员权限 |
| 输入 | 变量名 |
| 处理流程 | <br>1. 打开注册表<br>2. 删除环境变量<br>3. 广播变更消息 |
| 输出 | 成功/失败 |
| 后置条件 | 环境变量已删除 |

#### FR-014 添加 PATH 条目
| 项目 | 内容 |
|------|------|
| 编号 | FR-014 |
| 名称 | 添加 PATH 条目 |
| 描述 | 向 PATH 环境变量添加条目 |
| 前置条件 | 具有管理员权限 |
| 输入 | 路径条目 |
| 处理流程 | <br>1. 检查条目是否已存在<br>2. 不存在则添加<br>3. 保存并广播 |
| 输出 | 成功/失败 |
| 后置条件 | PATH 已更新 |

#### FR-015 移除 PATH 条目
| 项目 | 内容 |
|------|------|
| 编号 | FR-015 |
| 名称 | 移除 PATH 条目 |
| 描述 | 从 PATH 环境变量移除条目 |
| 前置条件 | 具有管理员权限 |
| 输入 | 路径条目 |
| 处理流程 | <br>1. 移除指定条目<br>2. 保存并广播 |
| 输出 | 成功/失败 |
| 后置条件 | PATH 已更新 |

### 3.5 CLI 命令模块

#### FR-016 list 命令
| 项目 | 内容 |
|------|------|
| 编号 | FR-016 |
| 名称 | list 命令 |
| 描述 | 列出已安装或远程版本 |
| 输入 | 工具名（可选）、--remote、--format |
| 输出 | 版本列表 |

#### FR-017 use 命令
| 项目 | 内容 |
|------|------|
| 编号 | FR-017 |
| 名称 | use 命令 |
| 描述 | 切换到指定版本 |
| 输入 | 工具名、版本号 |
| 输出 | 操作结果 |

#### FR-018 install 命令
| 项目 | 内容 |
|------|------|
| 编号 | FR-018 |
| 名称 | install 命令 |
| 描述 | 下载并安装指定版本 |
| 输入 | 工具名、版本号 |
| 输出 | 下载进度、操作结果 |

#### FR-019 uninstall 命令
| 项目 | 内容 |
|------|------|
| 编号 | FR-019 |
| 名称 | uninstall 命令 |
| 描述 | 卸载指定版本 |
| 输入 | 工具名、版本号 |
| 输出 | 操作结果 |

#### FR-020 root 命令
| 项目 | 内容 |
|------|------|
| 编号 | FR-020 |
| 名称 | root 命令 |
| 描述 | 设置或显示工具根目录 |
| 输入 | 工具名、路径（可选） |
| 输出 | 根目录路径或操作结果 |

#### FR-021 config 命令
| 项目 | 内容 |
|------|------|
| 编号 | FR-021 |
| 名称 | config 命令 |
| 描述 | 显示或编辑配置 |
| 输入 | --edit、--set |
| 输出 | 配置内容或操作结果 |

#### FR-022 tools 命令
| 项目 | 内容 |
|------|------|
| 编号 | FR-022 |
| 名称 | tools 命令 |
| 描述 | 列出所有已配置工具 |
| 输入 | 无 |
| 输出 | 工具列表 |

## 4. 非功能需求

### 4.1 性能需求
| 编号 | 需求 | 测量方法 |
|------|------|----------|
| NFR-001 | 应用启动时间 &lt; 2 秒 | 从启动到界面显示 |
| NFR-002 | 环境变量切换响应时间 &lt; 1 秒 | 从点击切换到完成 |
| NFR-003 | 版本列表获取 &lt; 3 秒（网络正常） | 从请求到显示 |

### 4.2 可靠性需求
| 编号 | 需求 |
|------|------|
| NFR-004 | 配置文件采用原子保存，防止损坏 |
| NFR-005 | 所有操作都有异常处理和错误提示 |
| NFR-006 | 危险操作需要用户确认 |
| NFR-007 | 所有操作都有日志记录 |

### 4.3 可用性需求
| 编号 | 需求 |
|------|------|
| NFR-008 | 界面简洁直观，操作流程清晰 |
| NFR-009 | 错误提示友好，具有指导意义 |
| NFR-010 | 支持管理员权限自动检测和请求 |

### 4.4 可维护性需求
| 编号 | 需求 |
|------|------|
| NFR-011 | 代码模块化，结构清晰 |
| NFR-012 | 有完善的日志系统 |
| NFR-013 | 遵循编码规范 |

### 4.5 可扩展性需求
| 编号 | 需求 |
|------|------|
| NFR-014 | 易于新增工具支持（配置驱动） |
| NFR-015 | 接口抽象，便于单元测试 |

## 5. 外部接口需求

### 5.1 用户界面
- GUI：使用 PySide6 + QML 实现
- CLI：使用 argparse 实现

### 5.2 软件接口
- Windows 注册表 API
- HTTP 客户端（下载）
- 子进程执行（版本检测）

### 5.3 通信接口
- HTTP/HTTPS（从镜像源下载）

## 6. 数据需求

### 6.1 配置文件
- 格式：JSON
- 位置：项目目录/config/config.json（或打包后 EXE 所在目录/config/config.json）
- 内容：工具配置、当前版本等

### 6.2 缓存文件
- 格式：JSON
- 位置：项目目录/config/cache.json（或打包后 EXE 所在目录/config/cache.json）
- 内容：远程版本列表缓存

### 6.3 日志文件
- 格式：文本
- 内容：操作日志、错误日志

## 7. 验收标准

| 编号 | 验收项 | 验收方法 |
|------|--------|----------|
| AC-001 | 所有功能需求（FR-001 ~ FR-022）实现并通过测试 | 功能测试 |
| AC-002 | 所有非功能需求（NFR-001 ~ NFR-015）满足 | 性能测试、可用性评估 |
| AC-003 | 代码符合规范，无严重 bug | 代码审查、测试 |
| AC-004 | 文档完整准确 | 文档审查 |
