# 接口文档

## 1. 概述

本文档描述 Mysysenv 系统的核心接口定义。

## 2. 核心接口

### 2.1 IConfigManager（配置管理器接口）

#### 2.1.1 load_config()
```python
def load_config(self) -> dict[str, Any]:
    """
    加载配置文件
    
    返回:
        配置字典
    """
```

#### 2.1.2 save_config()
```python
def save_config(self, config: dict[str, Any] | None = None) -> None:
    """
    保存配置到文件
    
    参数:
        config: 要保存的配置字典，如果为 None 则保存当前配置
    """
```

#### 2.1.3 get_config()
```python
def get_config(self) -> dict[str, Any]:
    """
    获取配置字典
    
    返回:
        配置字典
    """
```

#### 2.1.4 get_tool_templates()
```python
def get_tool_templates(self) -> dict[str, Any]:
    """
    获取所有工具配置模板
    
    返回:
        工具名称到配置模板的映射字典
    """
```

#### 2.1.5 get_tool_template()
```python
def get_tool_template(self, tool: str) -> dict[str, Any]:
    """
    获取指定工具的配置模板
    
    参数:
        tool: 工具名称
    
    返回:
        工具配置模板字典
    """
```

#### 2.1.6 get_tool_root()
```python
def get_tool_root(self, tool: str) -> str:
    """
    获取指定工具的根目录路径
    
    参数:
        tool: 工具名称
    
    返回:
        根目录路径
    """
```

#### 2.1.7 add_tool_config()
```python
def add_tool_config(self, tool_name: str) -> bool:
    """
    添加新工具配置
    
    参数:
        tool_name: 工具名称
    
    返回:
        成功返回 True，工具已存在返回 False
    """
```

#### 2.1.8 delete_tool_config()
```python
def delete_tool_config(self, tool_name: str) -> bool:
    """
    删除工具配置
    
    参数:
        tool_name: 工具名称
    
    返回:
        成功返回 True
    """
```

### 2.2 IEnvManager（环境管理器接口）

#### 2.2.1 get_env_var()
```python
def get_env_var(self, name: str) -> Optional[str]:
    """
    获取环境变量值
    
    参数:
        name: 环境变量名称
    
    返回:
        环境变量值，不存在则返回 None
    """
```

#### 2.2.2 set_env_var()
```python
def set_env_var(self, name: str, value: str) -> bool:
    """
    设置环境变量值
    
    参数:
        name: 环境变量名称
        value: 环境变量值
    
    返回:
        设置成功返回 True
    """
```

#### 2.2.3 delete_env_var()
```python
def delete_env_var(self, name: str) -> bool:
    """
    删除环境变量
    
    参数:
        name: 环境变量名称
    
    返回:
        删除成功返回 True
    """
```

#### 2.2.4 get_path_entries()
```python
def get_path_entries(self) -> List[str]:
    """
    获取 PATH 环境变量的所有条目
    
    返回:
        PATH 条目列表
    """
```

#### 2.2.5 add_to_path()
```python
def add_to_path(self, entry: str) -> bool:
    """
    向 PATH 环境变量添加新条目
    
    参数:
        entry: 要添加的路径条目
    
    返回:
        添加成功返回 True
    """
```

#### 2.2.6 remove_from_path()
```python
def remove_from_path(self, entry: str) -> bool:
    """
    从 PATH 环境变量移除条目
    
    参数:
        entry: 要移除的路径条目
    
    返回:
        移除成功返回 True
    """
```

#### 2.2.7 setup_tool_env()
```python
def setup_tool_env(
    self,
    tool: str,
    home_var: str,
    path: str,
    path_entries: List[str]
) -> bool:
    """
    设置工具的环境变量
    
    参数:
        tool: 工具名称
        home_var: HOME 环境变量名称
        path: 工具安装路径
        path_entries: 要添加到 PATH 的子目录列表
    
    返回:
        设置成功返回 True
    """
```

### 2.3 VersionManager（版本管理器）

#### 2.3.1 scan_local_versions()
```python
def scan_local_versions(self, tool: str) -> List[dict]:
    """
    扫描本地已安装的版本
    
    参数:
        tool: 工具名称
    
    返回:
        版本列表，每个元素包含 version 和 path
    """
```

#### 2.3.2 get_remote_versions()
```python
def get_remote_versions(self, tool: str) -> List[dict]:
    """
    获取远程可用版本列表
    
    参数:
        tool: 工具名称
    
    返回:
        版本列表
    """
```

#### 2.3.3 download_version()
```python
def download_version(
    self,
    tool: str,
    version: str,
    progress_callback: Optional[Callable[[int, int], None]] = None
) -> bool:
    """
    下载并安装指定版本
    
    参数:
        tool: 工具名称
        version: 版本号
        progress_callback: 进度回调函数
    
    返回:
        成功返回 True
    """
```

#### 2.3.4 switch_version()
```python
def switch_version(self, tool: str, version: str) -> bool:
    """
    切换到指定版本
    
    参数:
        tool: 工具名称
        version: 版本号
    
    返回:
        成功返回 True
    """
```

#### 2.3.5 delete_version()
```python
def delete_version(self, tool: str, version: str) -> bool:
    """
    卸载指定版本
    
    参数:
        tool: 工具名称
        version: 版本号
    
    返回:
        成功返回 True
    """
```

#### 2.3.6 get_current_version()
```python
def get_current_version(self, tool: str) -> Optional[str]:
    """
    获取当前使用的版本
    
    参数:
        tool: 工具名称
    
    返回:
        当前版本号，未设置则返回 None
    """
```

### 2.4 CLI 接口

#### 2.4.1 命令列表
| 命令 | 说明 |
|------|------|
| list | 列出已安装或远程版本 |
| use | 切换到指定版本 |
| install | 下载并安装指定版本 |
| uninstall | 卸载指定版本 |
| root | 设置或显示工具根目录 |
| config | 显示或编辑配置 |
| tools | 列出所有已配置工具 |

#### 2.4.2 list 命令
```
用法: mse list [tool] [--remote] [--format {table,json,simple}]

参数:
  tool              工具名称（可选）
  --remote, -r      显示远程可用版本
  --format, -f      输出格式
```

#### 2.4.3 use 命令
```
用法: mse use <tool> <version>

参数:
  tool      工具名称
  version   版本号
```

#### 2.4.4 install 命令
```
用法: mse install <tool> <version>

参数:
  tool      工具名称
  version   版本号
```

#### 2.4.5 uninstall 命令
```
用法: mse uninstall <tool> <version>

参数:
  tool      工具名称
  version   版本号
```

#### 2.4.6 root 命令
```
用法: mse root <tool> [path]

参数:
  tool      工具名称
  path      根目录路径（可选，省略则显示当前路径）
```

#### 2.4.7 config 命令
```
用法: mse config [--edit] [--set KEY=VALUE]

参数:
  --edit, -e        在编辑器中打开配置
  --set, -s         设置配置值
```

#### 2.4.8 tools 命令
```
用法: mse tools

参数:
  无
```

## 3. 信号（Qt 信号）

### 3.1 Backend 信号
| 信号名 | 参数 | 说明 |
|--------|------|------|
| toolListChanged | 无 | 工具列表已变更 |
| currentToolChanged | tool: str | 当前选中工具已变更 |
| versionListChanged | 无 | 版本列表已变更 |
| configChanged | 无 | 配置已变更 |
| errorOccurred | message: str | 发生错误 |
| infoMessage | message: str | 信息消息 |
